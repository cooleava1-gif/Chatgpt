<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>基金看板（GitHub Pages）</title>
  <link rel="stylesheet" href="./style.css?v=20260202_fix2">
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">¥</div>
      <div>
        <div class="title">基金看板</div>
        <div class="sub">场外净值为准 · 估值仅参考 · 1分钟自动刷新</div>
      </div>
    </div>

    <div class="status" id="status">JS：加载中…</div>
  </header>

  <main class="wrap">
    <!-- 汇总 -->
    <section class="card">
      <div class="card-hd">
        <div class="h1">总览</div>
        <div class="hint" id="hint">持仓数：0</div>
      </div>

      <div class="metrics">
        <div class="metric">
          <div class="k">投入</div>
          <div class="v" id="mInvest">--</div>
        </div>
        <div class="metric">
          <div class="k">市值</div>
          <div class="v" id="mValue">--</div>
        </div>
        <div class="metric">
          <div class="k">盈亏</div>
          <div class="v" id="mProfit">--</div>
        </div>
        <div class="metric">
          <div class="k">收益率</div>
          <div class="v" id="mRoi">--</div>
        </div>
      </div>

      <div class="toolbar">
        <div class="row">
          <label class="lb">自动刷新</label>
          <select id="auto" class="sel">
            <option value="0">关闭</option>
            <option value="30">30 秒</option>
            <option value="60" selected>60 秒</option>
            <option value="120">120 秒</option>
          </select>

          <button id="btnRefresh" class="btn">手动刷新</button>
          <button id="btnWipe" class="btn danger">清空持仓</button>
        </div>
      </div>
    </section>

    <!-- 新增持仓 -->
    <section class="card">
      <div class="card-hd">
        <div class="h1">新增持仓</div>
        <div class="hint">金额模式：你只填“投入金额”，系统会自动换算份额</div>
      </div>

      <div class="form">
        <div class="grid">
          <div class="field">
            <div class="lb">代码（6位）</div>
            <input id="inCode" class="ipt" placeholder="例如：001467 / 161226" />
          </div>

          <div class="field">
            <div class="lb">类型</div>
            <select id="inType" class="sel">
              <option value="fund" selected>基金（场外净值）</option>
              <option value="lof">LOF（默认按场外净值）</option>
              <option value="market">场内（按场内价）</option>
            </select>
          </div>

          <div class="field" id="lofModeWrap" style="display:none">
            <div class="lb">LOF计价方式</div>
            <select id="inLofPriceMode" class="sel">
              <option value="nav" selected>按场外净值算盈亏（推荐）</option>
              <option value="mkt">按场内价算盈亏（含溢价）</option>
            </select>
          </div>

          <div class="field">
            <div class="lb">买入日</div>
            <input id="inBuyDate" class="ipt" type="date" />
          </div>

          <div class="field">
            <div class="lb">投入金额（元）</div>
            <input id="inAmount" class="ipt" type="number" min="0" step="0.01" placeholder="例如：100" />
          </div>

          <div class="field">
            <div class="lb">成本单价（可选）</div>
            <input id="inCostPrice" class="ipt" type="number" min="0" step="0.0001" placeholder="不填=自动（用确认净值/当前价）" />
          </div>
        </div>

        <div class="row gap">
          <button id="btnAdd" class="btn primary" type="button">新增</button>
          <button id="btnClear" class="btn" type="button">清空输入</button>
        </div>

        <div class="note">
          <div>⚠ 场外基金：成本默认用“确认日净值”；收益起算日=确认日后一个交易日（近似 T+1）。</div>
          <div>⚠ “估值”是盘中推算，会偏；“净值”是官方结果（通常 T-1）。</div>
        </div>
      </div>
    </section>

    <!-- 7日曲线 -->
    <section class="card">
      <div class="card-hd">
        <div class="h1">7日曲线</div>
        <div class="hint">按买入日起，截取最近 7 个交易日做“累计收益”曲线</div>
      </div>

      <div class="chartbar">
        <label class="lb">选择持仓</label>
        <select id="selChart" class="sel"></select>
        <div class="muted" id="chartMeta">--</div>
      </div>

      <div class="chartwrap">
        <canvas id="chart" width="1100" height="320"></canvas>
      </div>
    </section>

    <!-- 持仓表 -->
    <section class="card">
      <div class="card-hd">
        <div class="h1">持仓明细</div>
        <div class="hint">盈亏默认按“场外净值”为准（除非你选了场内/LOF按场内价）</div>
      </div>

      <div class="tablewrap">
        <table class="tbl">
          <thead>
            <tr>
              <th>名称/代码</th>
              <th>类型</th>
              <th>买入日</th>
              <th>确认/起息</th>
              <th>投入</th>
              <th>成本单价</th>
              <th>份额</th>
              <th>净值(日期)</th>
              <th>估值(时间)</th>
              <th>场内价</th>
              <th>溢价</th>
              <th>市值</th>
              <th>盈亏</th>
              <th>收益率</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody id="tb"></tbody>
        </table>
      </div>
    </section>

    <footer class="footer">
      <div class="muted">
        数据源：东方财富（净值/行情）+ 天天基金估值脚本（估值）。如遇接口波动属正常现象。
      </div>
    </footer>
  </main>

  <!-- 只引用 app.js，不要再内嵌脚本 -->
  <script src="./app.js?v=20260202_fix2"></script>
</body>
</html>
